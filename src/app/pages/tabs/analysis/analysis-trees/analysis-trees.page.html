<app-header backButton="/tabs/analysis" title="Análisis: Limón"></app-header>


<ion-content>


  <div class="btn-container">
    <!-- Añadir árbol -->
    <div class="btn-gradient">
      <ion-button routerLink="/tabs/analysis/take-photos" mode="ios">
        <span>Añadir árbol</span>
      </ion-button>
    </div>

    <!-- Generar Reporte -->
    <div *ngIf="!loading" class="btn-gradient">
      <ion-button (click)="generateFiles()" [disabled]="pendingTrees.length || !analysisFormData().trees.length" mode="ios">
        <span>Generar reporte</span>
      </ion-button>
    </div>
  </div>


  <ion-segment class="ion-padding-top" [(ngModel)]="segment">
    <ion-segment-button value="pending">
      <ion-label>Árboles Pendientes</ion-label>
    </ion-segment-button>
    <ion-segment-button value="ready">
      <ion-label>Árboles Analizados</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- =========================== Árboles Pendientes ========================== -->

  <div *ngIf="segment == 'pending' && (pendingTrees.length && !loading)" class="table-container">

    <div class="msg">
      Cada análisis puede tomar entre 13 y 15 minutos. Recuerda tener una buena conexión antes de realizar un análisis

      <!-- <div class="btn-gradient">
        <ion-button routerLink="/tabs/reports" mode="ios">
          <span>Analizar Todo</span>
        </ion-button>
      </div> -->
    </div>


    <table>
      <thead>
        <th>Número</th>
        <th>Imágenes</th>
        <th>Analizar</th>
        <th>Eliminar</th>
      </thead>

      <tr *ngFor="let p of pendingTrees; index as i">
        <td>{{i+1+analysisFormData().trees.length}}</td>
        <td>
          <div class="wrapper">
            <div class="avatar-group pb-item">
              <div *ngFor="let img of p.images" class="avatar">
                <img [src]="img.file" />
              </div>
            </div>
          </div>
        </td>

        <td>
          <ion-icon (click)="uploadPhotosToFireStorage(p)" class="option-icon" src="assets/icon/icon-analisis.svg"></ion-icon>
        </td>

        <td>
          <ion-icon (click)="deletePendingTree(p.id)" class="option-icon" name="trash-outline"></ion-icon>
        </td>
      </tr>
    </table>
  </div>

  <!-- =========================== Sin Árboles Pendientes ========================== -->
  <div style="padding-top: 15vh;" *ngIf="segment == 'pending' && (!pendingTrees.length && !loading)">
    <app-empty-array iconSrc="assets/icon/icon-analisis.svg" text="No hay árboles pendientes por analizar">
    </app-empty-array>
  </div>

  <div *ngIf="loading" style="padding-top: 15vh;" class="ion-text-center">
    <ion-spinner style="padding: 40px;" color="primary" name="crescent"></ion-spinner>
  </div>


  <!-- =========================== Árboles Analizados ========================== -->

  <div *ngIf="segment == 'ready' && (analysisFormData().trees.length && !loading)" class="table-container">
    <table>
      <thead>
        <th>Número</th>
        <th>Acierto</th>
        <th>Ver</th>
        <th>Rehacer</th>
      </thead>
      <tr *ngFor="let t of analysisFormData().trees; index as i">
        <td>{{i + 1}}</td>
        <td>{{t.lemons.confidenceAvergae.toFixed(2)}} %</td>
        <td>
          <ion-icon routerLink="/tabs/analysis/analysis-resumen/{{i}}" class="option-icon"
            src="assets/icon/icon-reportes.svg"></ion-icon>
        </td>
        <td>
          <ion-icon (click)="confirmRedoAnalysis(i)" class="option-icon" src="assets/icon/icon-analisis.svg"></ion-icon>
        </td>
      </tr>
    </table>
  </div>

  <!-- =========================== Sin Árboles Analizados ========================== -->
  <div style="padding-top: 15vh;" *ngIf="segment == 'ready' && (!analysisFormData().trees.length && !loading)">
    <app-empty-array iconSrc="assets/icon/icon-analisis.svg" text="No hay árboles analizados">
    </app-empty-array>
  </div>

</ion-content>